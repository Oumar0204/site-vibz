<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Activit√©s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { min-height:100vh; background:url("FondVibz.png") no-repeat center/cover; display:flex; justify-content:center; align-items:center; padding-right:90px;}
    body::before { content:""; position:fixed; inset:0; background:rgba(255,255,255,0.8); z-index:-1;}

    /* bandeau utilisateur */
    #user-banner {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #22c55e;
      color: white;
      padding: 8px 14px;
      border-radius: 12px;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      z-index: 10;
    }

    .card { background:white; width:100%; max-width:360px; padding:30px; border-radius:24px; text-align:center;}
    .activity-image { width:100%; height:180px; object-fit:cover; border-radius:18px; margin-bottom:20px;}
    .activity-name { font-size:22px; font-weight:600; margin-bottom:6px;}
    .activity-location { color:#6b7280; margin-bottom:30px;}
    .actions { display:flex; justify-content:space-between; margin-top:30px;}
    .btn { width:60px; height:60px; border-radius:50%; border:none; font-size:26px; cursor:pointer; transition: transform 0.2s ease;}
    .btn:hover { transform: scale(1.1);}
    .btn-no { background:#ef4444; color:white;}
    .btn-yes { background:#22c55e; color:white;}
    .empty { font-size:18px; color:#6b7280;}
    .sidebar { position:fixed; right:20px; top:50%; transform:translateY(-50%); display:flex; flex-direction:column; gap:22px; background:white; padding:18px 14px; border-radius:30px; 
box-shadow:0 10px 30px rgba(0,0,0,0.12);}
    .sidebar img { width:28px; height:28px; cursor:pointer; opacity:0.7; transition:transform 0.2s ease, opacity 0.2s ease;}
    .sidebar img:hover { transform:scale(1.2); opacity:1;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<div class="card" id="location-card">
  <h3 style="margin-bottom:15px;">Choisis ta localisation</h3>

  <select id="countrySelect" style="width:100%; padding:10px; border-radius:12px; margin-bottom:15px;">
    <option value="">S√©lectionne un pays</option>
<option value="allemagne">Allemagne</option>
<option value="albanie">Albanie</option>
<option value="autriche">Autriche</option>
<option value="belgique">Belgique</option>
<option value="bosnie">Bosnie-Herz√©govine</option>
<option value="bulgarie">Bulgarie</option>
<option value="chypre">Chypre</option>
<option value="croatie">Croatie</option>
<option value="danemark">Danemark</option>
<option value="espagne">Espagne</option>
<option value="estonie">Estonie</option>
<option value="finlande">Finlande</option>
<option value="france">France</option>
<option value="grece">Gr√®ce</option>
<option value="hongrie">Hongrie</option>
<option value="irlande">Irlande</option>
<option value="islande">Islande</option>
<option value="italie">Italie</option>
<option value="lettonie">Lettonie</option>
<option value="lituanie">Lituanie</option>
<option value="luxembourg">Luxembourg</option>
<option value="macedoine">Mac√©doine du Nord</option>
<option value="malte">Malte</option>
<option value="montenegro">Mont√©n√©gro</option>
<option value="norvege">Norv√®ge</option>
<option value="paysbas">Pays-Bas</option>
<option value="pologne">Pologne</option>
<option value="portugal">Portugal</option>
<option value="roumanie">Roumanie</option>
<option value="royaumeuni">Royaume-Uni</option>
<option value="serbie">Serbie</option>
<option value="slovaquie">Slovaquie</option>
<option value="slovenie">Slov√©nie</option>
<option value="suede">Su√®de</option>
<option value="suisse">Suisse</option>
<option value="tchequie">Tch√©quie</option>

  </select>

  <select id="citySelect" style="width:100%; padding:10px; border-radius:12px; margin-bottom:20px;" disabled>
    <option value="">S√©lectionne une ville</option>
  </select>

  <button class="btn btn-yes" style="width:100%; border-radius:14px;" onclick="validateLocation()">
    Valider
  </button>
</div>

<!-- Bouton cr√©ation -->
<button onclick="openCreate()" 
style="position:fixed; bottom:30px; left:30px; background:#22c55e; color:white; border:none; padding:14px 20px; border-radius:16px; font-size:16px; cursor:pointer; z-index:20;">
+ Cr√©er une activit√©
</button>

<!-- Modal cr√©ation -->
<div id="createModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); justify-content:center; align-items:center; z-index:50;">
  <div style="background:white; padding:25px; border-radius:20px; width:320px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
  <h3>Cr√©er une activit√©</h3>

  <button onclick="closeCreate()"
    style="background:none; border:none; font-size:22px; cursor:pointer;">
    ‚úï
  </button>
</div>


    <input id="actName" placeholder="Nom de l'activit√©" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px;">

    <select id="actCountry" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px;">
      <option value="">S√©lectionne un pays</option>
    </select>

    <select id="actCity" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px;" disabled>
      <option value="">S√©lectionne une ville</option>
    </select>

    <input type="date" id="actDate" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px;">
    <input type="time" id="actTime" style="width:100%; padding:10px; margin-bottom:15px; border-radius:10px;">

    <button onclick="createActivity()" style="width:100%; background:#22c55e; color:white; border:none; padding:12px; border-radius:12px;">
      Cr√©er
    </button>
  </div>
</div>

<!-- Bandeau utilisateur -->
<div id="user-banner">Oumar</div>

<!-- Carte activit√© -->
<div class="card" id="card">
<button id="backBtn"
style="margin-bottom:15px; background:#e5e7eb; border:none; padding:8px 14px; border-radius:12px; cursor:pointer;">
‚Üê Retour
</button>

  <img id="activity-image" class="activity-image" src="" alt="activit√©">
  <div class="activity-name" id="activity-name"></div>
  <div class="activity-location" id="activity-location"></div>

  <div class="actions">
    <button class="btn btn-no" onclick="reject()">‚úï</button>
    <button class="btn btn-yes" onclick="like()">‚ù§</button>
  </div>
</div>

<!-- Sidebar -->
<div class="sidebar">
  <img src="message.jpg" alt="Messages" onclick="location.href='message.html'">
  <img src="eclaire.png" alt="D√©couvrir" onclick="location.href='favoris.html'">
  <img src="compte.png" alt="Compte" onclick="location.href='compte.html'">
  <img src="parametre.png" alt="Param√®tres" onclick="location.href='parametre.html'">
</div>
<script>
const supabase = window.supabase.createClient(
  "https://oppyogcmkfctmkbhnbly.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9wcHlvZ2Nta2ZjdG1rYmhuYmx5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwNzI5NDgsImV4cCI6MjA4NDY0ODk0OH0.Diimf05_xtEukBNk4sQb8IzUeRvQA2la32l0-wHFvH0"
);
</script>

<script>
  const activities = [
    { id: 1, name: "Bowling", location: "Paris 15e", city: "Paris", country: "france", image: "bowling.jpg" },
    { id: 2, name: "Escape Game", location: "La D√©fense", city: "Paris", country: "france", image: "escape.jpg" },
    { id: 3, name: "Concert Rap", location: "Bercy", city: "Paris", country: "france", image: "concert.jpg" },
    { id: 4, name: "Cin√©ma plein air", location: "Parc de la Villette", city: "Paris", country: "france", image: "cinema.jpg" },
    { id: 5, name: "Karting", location: "Thiais", city: "Paris", country: "france", image: "karting.jpg      " },
    { id: 6, name: "Patinoire", location: "Paris 16e", city: "Paris", country: "france", image: "patinoire.jpg" },
    { id: 7, name: "Mus√©e d'art", location: "Louvre", city: "Paris", country: "france", image: "musee.jpg" },
    { id: 8, name: "Randonn√©e", location: "For√™t de Fontainebleau", city: "Paris", country: "france", image: "rando.jpg" },
    { id: 9, name: "Plage", location: "Deauville", city: "Paris", country: "france", image: "plage.jpg" },
    { id: 10, name: "Paintball", location: "Montreuil", city: "Paris", country: "france", image: "paintball.jpg" },
    { id: 11, name: "Karting Indoor", location: "Nanterre", city: "Paris", country: "france", image: "karting2.jpg" },
    { id: 12, name: "Parc d'attractions", location: "Disneyland Paris", city: "Paris", country: "france", image: "disney.jpg" }
  ];

const cities = {
  france: ["Paris", "Lyon", "Marseille", "Lille", "Bordeaux", "Nice"],
  belgique: ["Bruxelles", "Anvers", "Li√®ge"],
  suisse: ["Gen√®ve", "Lausanne", "Zurich"],
  allemagne: ["Berlin", "Munich", "Hambourg", "Francfort"],
  espagne: ["Madrid", "Barcelone", "Valence", "S√©ville"],
  portugal: ["Lisbonne", "Porto"],
  italie: ["Rome", "Milan", "Naples", "Turin"],
  royaumeuni: ["Londres", "Manchester", "Liverpool"],
  paysbas: ["Amsterdam", "Rotterdam", "Utrecht"],
  luxembourg: ["Luxembourg"],
  autriche: ["Vienne", "Salzbourg"],
  suede: ["Stockholm", "G√∂teborg"],
  norvege: ["Oslo", "Bergen"],
  danemark: ["Copenhague"],
  finlande: ["Helsinki"],
  irlande: ["Dublin", "Cork"],
  pologne: ["Varsovie", "Cracovie"],
  tchequie: ["Prague", "Brno"],
  slovaquie: ["Bratislava"],
  hongrie: ["Budapest"],
  roumanie: ["Bucarest"],
  bulgarie: ["Sofia"],
  grece: ["Ath√®nes", "Thessalonique"],
  croatie: ["Zagreb", "Split"],
  slovenie: ["Ljubljana"],
  serbie: ["Belgrade"],
  bosnie: ["Sarajevo"],
  montenegro: ["Podgorica"],
  albanie: ["Tirana"],
  macedoine: ["Skopje"],
  estonie: ["Tallinn"],
  lettonie: ["Riga"],
  lituanie: ["Vilnius"],
  islande: ["Reykjavik"],
  malte: ["La Valette"],
  chypre: ["Nicosie"]
};

let currentUser = null;
let index = 0;
let filteredActivities = [];
let selectedCity = null;

// Elements
const nameEl = document.getElementById("activity-name");
const locationEl = document.getElementById("activity-location");
const imageEl = document.getElementById("activity-image");
const card = document.getElementById("card");

// ‚ö° Charger utilisateur
async function loadUser() {
  const { data } = await supabase.auth.getUser();
  currentUser = data.user;

  if (!currentUser) {
    location.href = "connexion.html";
  }
}
await loadUser();

// ‚ö° Afficher activit√©
function showActivity() {
  const act = filteredActivities.length ? filteredActivities[index] : activities[index];

  if (!act) {
    card.innerHTML = `<div class="empty">Plus d'activit√©s üòî</div>`;
    return;
  }

  nameEl.textContent = act.name;
  locationEl.textContent = `${act.city}, ${act.country}`;
  imageEl.src = act.image;
}

// ‚ö° Like une activit√© et sauvegarde sur Supabase
// exemple pour "like" une activit√©
async function like() {
  if (!currentUser) return;

  const activity = filteredActivities.length
    ? filteredActivities[index]
    : activities[index];

  try {
    await supabase.from("favorites").insert({
      user_id: currentUser.id,
      activity_id: activity.id
    });
  } catch (err) {
    console.error(err);
  }

  index++;
  showFilteredActivity();
}


// ‚ö° Rejeter
function reject() {
  index++;
  showActivity();
}

// ‚ö° Filtrer activit√©s selon localisation
function validateLocation() {
  const country = countrySelect.value;
  const city = citySelect.value;

  if (!country || !city) return alert("Choisis un pays et une ville");

  selectedCity = city;
  filteredActivities = activities.filter(a => a.city === city && a.country === country);

  index = 0;
  locationCard.style.display = "none";
  card.style.display = "block";
  showActivity();
}

// ‚ö° Cr√©er activit√© localement et sur Supabase
async function createActivity() {
  const name = document.getElementById("actName").value.trim();
  const city = actCity.value;
  const country = actCountry.value;
  const date = document.getElementById("actDate").value;
  const time = document.getElementById("actTime").value;

  if (!name || !city || !country || !date || !time) return alert("Remplis tous les champs");

  const selected = new Date(date + "T" + time);
  const now = new Date();
  const twoMonthsLater = new Date();
  twoMonthsLater.setMonth(now.getMonth() + 2);

  if (selected < now) return alert("Impossible dans le pass√©");
  if (selected > twoMonthsLater) return alert("Maximum 2 mois √† l‚Äôavance");

  const newAct = {
    id: Date.now(),
    name,
    city,
    country,
    image: "default.jpg"
  };

  // Ajouter localement
  activities.unshift(newAct);

  // Ajouter sur Supabase
  await supabase.from("activities").insert(newAct);

  index = 0;
  showActivity();
  closeCreate();
}

// ‚ö° Initialiser affichage
showActivity();

</body>
</html>